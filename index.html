<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chia VƒÉn B·∫£n Th√¥ng Minh v3.0</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 0 20px;
      line-height: 1.6;
      color: #333;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
        margin: 0;
      }
    }

    .container {
      background-color: #f9f9f9;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }

    textarea {
      width: 100%;
      min-height: 250px;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      resize: vertical;
      font-size: 15px;
      line-height: 1.5;
    }

    input[type="number"] {
      width: 80px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 15px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      background-color: #3498db;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
      transition: background-color 0.3s;
      flex-grow: 1;
    }

    button:hover {
      background-color: #2980b9;
    }

    button.primary {
      background-color: #2ecc71;
    }

    button.primary:hover {
      background-color: #27ae60;
    }

    button.secondary {
      background-color: #e74c3c;
    }

    button.secondary:hover {
      background-color: #c0392b;
    }

    .stats {
      margin: 15px 0;
      padding: 12px;
      background-color: #ecf0f1;
      border-radius: 6px;
      font-size: 14px;
    }

    .file-input-container {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    #fileInput {
      display: none;
    }

    .file-label {
      background-color: #9b59b6;
      color: white;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .file-label:hover {
      background-color: #8e44ad;
    }

    #fileName {
      color: #7f8c8d;
      font-size: 14px;
    }

    .note {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 20px;
      padding: 10px;
      background-color: #f0f3f4;
      border-radius: 4px;
    }

    .detected-language {
      font-weight: bold;
      color: #16a085;
      margin-bottom: 15px;
      padding: 10px;
      background-color: #e8f8f5;
      border-radius: 4px;
      display: none;
    }

    .progress-container {
      width: 100%;
      background-color: #ecf0f1;
      border-radius: 4px;
      margin: 15px 0;
      display: none;
    }

    .progress-bar {
      height: 20px;
      background-color: #3498db;
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s;
      text-align: center;
      color: white;
      font-size: 12px;
      line-height: 20px;
    }

    .advanced-options {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0f3f4;
      border-radius: 6px;
      display: none;
    }

    .toggle-options {
      color: #3498db;
      cursor: pointer;
      font-size: 14px;
      user-select: none;
    }

    .toggle-options:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>C√¥ng C·ª• Chia VƒÉn B·∫£n Th√¥ng Minh</h1>
    
    <div class="note">
      <strong>H·ªó tr·ª£ t·ª± ƒë·ªông nh·∫≠n di·ªán:</strong>
      <ul>
        <li>Ti·∫øng Vi·ªát: "Ch∆∞∆°ng X", "Ch∆∞∆°ng X:", "## Ch∆∞∆°ng X", "Ph·∫ßn X", "B√†i X"</li>
        <li>Ti·∫øng Trung: "Á¨¨XÁ´†", "Á¨¨XËäÇ", "Á¨¨XÂõû", "Á¨¨XÁØá"</li>
        <li>Ti·∫øng Anh: "Chapter X", "Part X", "Section X"</li>
      </ul>
    </div>
    
    <div id="languageInfo" class="detected-language"></div>
    
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>
    
    <div class="file-input-container">
      <label class="file-label" for="fileInput">
        üìÅ Ch·ªçn file vƒÉn b·∫£n
      </label>
      <span id="fileName"></span>
    </div>
    <input type="file" id="fileInput" accept=".txt,.docx,.pdf">
    
    <div class="form-group">
      <label for="inputText">VƒÉn b·∫£n c·∫ßn chia:</label>
      <textarea id="inputText" placeholder="Nh·∫≠p ho·∫∑c d√°n vƒÉn b·∫£n c·∫ßn chia v√†o ƒë√¢y..."></textarea>
    </div>
    
    <div class="form-group">
      <label for="numParts">S·ªë ph·∫ßn mu·ªën chia m·ªói ch∆∞∆°ng:</label>
      <input type="number" id="numParts" min="1" max="10" value="2">
    </div>
    
    <div class="toggle-options" onclick="toggleAdvancedOptions()">‚öôÔ∏è T√πy ch·ªçn n√¢ng cao</div>
    
    <div class="advanced-options" id="advancedOptions">
      <div class="form-group">
        <label for="minWords">S·ªë t·ª´ t·ªëi thi·ªÉu m·ªói ph·∫ßn:</label>
        <input type="number" id="minWords" min="50" value="200">
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="keepOriginal" checked>
          Gi·ªØ nguy√™n c·∫•u tr√∫c g·ªëc
        </label>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="addPageBreak">
          Th√™m ng·∫Øt trang gi·ªØa c√°c ph·∫ßn
        </label>
      </div>
    </div>
    
    <div class="button-group">
      <button class="primary" onclick="splitText()">‚úÇÔ∏è Chia vƒÉn b·∫£n</button>
      <button onclick="downloadText()">üì• T·∫£i xu·ªëng (.txt)</button>
      <button onclick="copyText()">üìã Sao ch√©p</button>
      <button class="secondary" onclick="clearAll()">üóëÔ∏è X√≥a h·∫øt</button>
    </div>
    
    <div id="stats" class="stats" style="display: none;"></div>
    
    <div class="form-group">
      <label for="outputText">K·∫øt qu·∫£:</label>
      <textarea id="outputText" readonly></textarea>
    </div>
  </div>

  <script type="text/javascript">
    // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u tr·∫°ng th√°i
    let detectedLanguage = '';
    let detectedStructure = '';
    
    // X·ª≠ l√Ω s·ª± ki·ªán file input
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('fileName').textContent = file.name;
        showProgress(30);
        
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('inputText').value = event.target.result;
          showProgress(70);
          setTimeout(() => {
            detectTextInfo();
            showProgress(100);
            setTimeout(hideProgress, 500);
          }, 300);
        };
        reader.readAsText(file, 'UTF-8');
      }
    });

    // Hi·ªÉn th·ªã thanh ti·∫øn tr√¨nh
    function showProgress(percent) {
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      progressContainer.style.display = 'block';
      progressBar.style.width = percent + '%';
      progressBar.textContent = percent + '%';
    }

    // ·∫®n thanh ti·∫øn tr√¨nh
    function hideProgress() {
      document.getElementById('progressContainer').style.display = 'none';
    }

    // Toggle hi·ªÉn th·ªã t√πy ch·ªçn n√¢ng cao
    function toggleAdvancedOptions() {
      const options = document.getElementById('advancedOptions');
      options.style.display = options.style.display === 'none' ? 'block' : 'none';
    }

    // X√≥a t·∫•t c·∫£ n·ªôi dung
    function clearAll() {
      document.getElementById('inputText').value = '';
      document.getElementById('outputText').value = '';
      document.getElementById('fileName').textContent = '';
      document.getElementById('fileInput').value = '';
      document.getElementById('stats').style.display = 'none';
      document.getElementById('languageInfo').style.display = 'none';
    }

    // Ph√°t hi·ªán ng√¥n ng·ªØ v√† c·∫•u tr√∫c vƒÉn b·∫£n
    function detectTextInfo() {
      const inputText = document.getElementById('inputText').value;
      if (!inputText.trim()) return;

      const result = detectLanguageAndStructure(inputText);
      if (!result) {
        document.getElementById('languageInfo').textContent = 'Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c c·∫•u tr√∫c ch∆∞∆°ng';
        document.getElementById('languageInfo').style.display = 'block';
        return;
      }

      detectedLanguage = result.language;
      detectedStructure = result.structure;

      const languageNames = {
        'vietnamese': 'Ti·∫øng Vi·ªát',
        'chinese': 'Ti·∫øng Trung',
        'english': 'Ti·∫øng Anh'
      };

      const structureNames = {
        'default': 'C·∫•u tr√∫c th∆∞·ªùng',
        'markdown': 'C·∫•u tr√∫c Markdown',
        'number-only': 'Ch·ªâ s·ªë ch∆∞∆°ng'
      };

      document.getElementById('languageInfo').textContent = 
        `ƒê√£ nh·∫≠n di·ªán: ${languageNames[detectedLanguage]} (${structureNames[detectedStructure]})`;
      document.getElementById('languageInfo').style.display = 'block';
    }

    // H√†m nh·∫≠n di·ªán ng√¥n ng·ªØ v√† c·∫•u tr√∫c
    function detectLanguageAndStructure(text) {
      // Danh s√°ch c√°c m·∫´u regex cho t·ª´ng ng√¥n ng·ªØ
      const patterns = [
        // Ti·∫øng Vi·ªát
        { language: 'vietnamese', structure: 'markdown', regex: /^## (Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+(\d+)(:|\.|\s|$)/mi },
        { language: 'vietnamese', structure: 'default', regex: /^(Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+(\d+)(:|\.|\s|$)/mi },
        
        // Ti·∫øng Trung
        { language: 'chinese', structure: 'default', regex: /^(Á¨¨\d+[Á´†ËäÇÁØáÂõû])(\s|$)/m },
        
        // Ti·∫øng Anh
        { language: 'english', structure: 'default', regex: /^(Chapter|Part|Section)\s+(\d+)(:|\.|\s|$)/mi },
        { language: 'english', structure: 'number-only', regex: /^(\d+)\.\s/m }
      ];

      // Ki·ªÉm tra t·ª´ng m·∫´u
      for (const pattern of patterns) {
        if (pattern.regex.test(text)) {
          return {
            language: pattern.language,
            structure: pattern.structure
          };
        }
      }

      return null;
    }

    // H√†m ch√≠nh ƒë·ªÉ chia vƒÉn b·∫£n
    function splitText() {
      const inputText = document.getElementById('inputText').value;
      const numParts = parseInt(document.getElementById('numParts').value) || 2;
      const minWords = parseInt(document.getElementById('minWords').value) || 200;
      const keepOriginal = document.getElementById('keepOriginal').checked;
      const addPageBreak = document.getElementById('addPageBreak').checked;

      if (!inputText.trim()) {
        alert('Vui l√≤ng nh·∫≠p vƒÉn b·∫£n ho·∫∑c ch·ªçn file!');
        return;
      }

      // N·∫øu ch∆∞a nh·∫≠n di·ªán, th·ª≠ nh·∫≠n di·ªán l·∫°i
      if (!detectedLanguage) {
        detectTextInfo();
        if (!detectedLanguage) {
          alert('Kh√¥ng th·ªÉ nh·∫≠n di·ªán c·∫•u tr√∫c vƒÉn b·∫£n. Vui l√≤ng ki·ªÉm tra l·∫°i!');
          return;
        }
      }

      showProgress(10);
      
      try {
        // T√°ch c√°c ch∆∞∆°ng theo ng√¥n ng·ªØ ƒë√£ nh·∫≠n di·ªán
        let chapters = [];
        let splitRegex;
        
        if (detectedLanguage === 'vietnamese') {
          if (detectedStructure === 'markdown') {
            splitRegex = /(?=^## (Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+\d+(:|\.|\s|$))/m;
          } else {
            splitRegex = /(?=^(Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+\d+(:|\.|\s|$))/m;
          }
        } 
        else if (detectedLanguage === 'chinese') {
          splitRegex = /(?=^Á¨¨\d+[Á´†ËäÇÁØáÂõû])/m;
        }
        else if (detectedLanguage === 'english') {
          if (detectedStructure === 'number-only') {
            splitRegex = /(?=^\d+\.\s)/m;
          } else {
            splitRegex = /(?=^(Chapter|Part|Section)\s+\d+(:|\.|\s|$))/mi;
          }
        }

        chapters = inputText.split(splitRegex).filter(ch => ch.trim());
        showProgress(30);

        if (chapters.length === 0) {
          alert('Kh√¥ng t√¨m th·∫•y ch∆∞∆°ng n√†o trong vƒÉn b·∫£n!');
          hideProgress();
          return;
        }

        let finalResult = '';
        let currentChapterNumber = 0;
        let totalWords = 0;
        let totalChapters = 0;

        // X·ª≠ l√Ω t·ª´ng ch∆∞∆°ng
        chapters.forEach((chapter, index) => {
          if (!chapter.trim()) return;
          
          let chapterTitleMatch;
          let chapterNumber;
          let chapterTitle = '';
          let chapterContent;
          let isEndOfLine = false;
          
          // X·ª≠ l√Ω theo t·ª´ng ng√¥n ng·ªØ
          if (detectedLanguage === 'vietnamese') {
            const titleRegex = detectedStructure === 'markdown' 
              ? /^## (Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+(\d+)(:|\.|\s|$)(.*?)$/mi 
              : /^(Ch∆∞∆°ng|Ph·∫ßn|B√†i)\s+(\d+)(:|\.|\s|$)(.*?)$/mi;
            
            chapterTitleMatch = chapter.match(titleRegex);
            if (!chapterTitleMatch) return;
            
            chapterNumber = parseInt(chapterTitleMatch[2]);
            chapterTitle = (chapterTitleMatch[4] || '').trim();
            chapterContent = chapter.substring(chapterTitleMatch[0].length);
          } 
          else if (detectedLanguage === 'chinese') {
            // Ki·ªÉm tra xem c√≥ ph·∫£i ·ªü cu·ªëi d√≤ng kh√¥ng
            const endOfLineMatch = chapter.match(/^(Á¨¨\d+[Á´†ËäÇÁØáÂõû])(\s*)$/m);
            if (endOfLineMatch) {
              isEndOfLine = true;
              chapterNumber = parseInt(endOfLineMatch[1].match(/\d+/)[0]);
              chapterContent = chapter.substring(endOfLineMatch[0].length);
            } else {
              chapterTitleMatch = chapter.match(/^(Á¨¨\d+[Á´†ËäÇÁØáÂõû])(?:\s+(.*?))?$/m);
              if (!chapterTitleMatch) return;
              
              chapterNumber = parseInt(chapterTitleMatch[1].match(/\d+/)[0]);
              chapterTitle = (chapterTitleMatch[2] || '').trim();
              chapterContent = chapter.substring(chapterTitleMatch[0].length);
            }
          }
          else if (detectedLanguage === 'english') {
            if (detectedStructure === 'number-only') {
              chapterTitleMatch = chapter.match(/^(\d+)\.\s(.*?)$/m);
              if (!chapterTitleMatch) return;
              
              chapterNumber = parseInt(chapterTitleMatch[1]);
              chapterTitle = (chapterTitleMatch[2] || '').trim();
              chapterContent = chapter.substring(chapterTitleMatch[0].length);
            } else {
              chapterTitleMatch = chapter.match(/^(Chapter|Part|Section)\s+(\d+)(:|\.|\s|$)(.*?)$/mi);
              if (!chapterTitleMatch) return;
              
              chapterNumber = parseInt(chapterTitleMatch[2]);
              chapterTitle = (chapterTitleMatch[4] || '').trim();
              chapterContent = chapter.substring(chapterTitleMatch[0].length);
            }
          }
          
          if (currentChapterNumber === 0) {
            currentChapterNumber = chapterNumber;
          }
          
          // T√≠nh to√°n s·ªë t·ª´ trong ch∆∞∆°ng
          const wordCount = chapterContent.split(/\s+/).filter(w => w.trim()).length;
          totalWords += wordCount;
          
          // X√°c ƒë·ªãnh s·ªë ph·∫ßn th·ª±c t·∫ø (kh√¥ng √≠t h∆°n minWords)
          let actualParts = numParts;
          if (wordCount / numParts < minWords) {
            actualParts = Math.max(1, Math.floor(wordCount / minWords));
          }
          
          const result = splitChapter(
            chapterContent, 
            currentChapterNumber, 
            chapterTitle, 
            actualParts, 
            isEndOfLine,
            keepOriginal,
            addPageBreak
          );
          
          finalResult += result.text;
          currentChapterNumber = result.nextChapterNumber;
          totalChapters++;
          
          showProgress(30 + (index / chapters.length * 60));
        });

        document.getElementById('outputText').value = finalResult;
        document.getElementById('stats').innerHTML = `
          <strong>Th·ªëng k√™:</strong><br>
          - T·ªïng s·ªë ch∆∞∆°ng: ${totalChapters}<br>
          - T·ªïng s·ªë t·ª´: ${totalWords}<br>
          - T·ª´ trung b√¨nh m·ªói ph·∫ßn: ${Math.round(totalWords/(totalChapters*numParts))}
        `;
        document.getElementById('stats').style.display = 'block';
        showProgress(100);
        setTimeout(hideProgress, 500);
      } catch (error) {
        console.error(error);
        alert('C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω vƒÉn b·∫£n: ' + error.message);
        hideProgress();
      }
    }

    // H√†m chia m·ªôt ch∆∞∆°ng th√†nh nhi·ªÅu ph·∫ßn
    function splitChapter(chapterText, chapterNumber, chapterTitle, numParts, isEndOfLine = false, keepOriginal = true, addPageBreak = false) {
      const lines = chapterText.split('\n');
      const pageBreak = addPageBreak ? '\n\n---\n\n' : '\n\n';
      
      // T√°ch th√†nh c√°c ƒëo·∫°n l·ªõn h∆°n l√† c√°c d√≤ng ƒë∆°n l·∫ª
      const paragraphs = [];
      let currentParagraph = [];
      
      for (const line of lines) {
        if (line.trim() === '' && currentParagraph.length > 0) {
          paragraphs.push({
            text: currentParagraph.join('\n'),
            wordCount: currentParagraph.join(' ').split(/\s+/).filter(w => w.trim()).length
          });
          currentParagraph = [];
        } else {
          currentParagraph.push(line);
        }
      }
      
      // Th√™m ƒëo·∫°n cu·ªëi c√πng n·∫øu c√≤n
      if (currentParagraph.length > 0) {
        paragraphs.push({
          text: currentParagraph.join('\n'),
          wordCount: currentParagraph.join(' ').split(/\s+/).filter(w => w.trim()).length
        });
      }

      const totalWords = paragraphs.reduce((sum, p) => sum + p.wordCount, 0);
      const targetWordsPerPart = Math.ceil(totalWords / numParts);

      const parts = [];
      let currentPart = [];
      let currentWordCount = 0;

      paragraphs.forEach((paragraph) => {
        if (
          currentWordCount + paragraph.wordCount > targetWordsPerPart &&
          parts.length < numParts - 1 &&
          currentWordCount > 0
        ) {
          parts.push({
            text: currentPart.join('\n\n'),
            wordCount: currentWordCount
          });
          currentPart = [paragraph.text];
          currentWordCount = paragraph.wordCount;
        } else {
          currentPart.push(paragraph.text);
          currentWordCount += paragraph.wordCount;
        }
      });

      if (currentPart.length > 0) {
        parts.push({
          text: currentPart.join('\n\n'),
          wordCount: currentWordCount
        });
      }

      let result = '';
      parts.forEach((part, index) => {
        const partNumber = index + 1;
        const currentChapter = chapterNumber + index;
        
        // T·∫°o ti√™u ƒë·ªÅ ch∆∞∆°ng t√πy theo ng√¥n ng·ªØ v√† c·∫•u tr√∫c
        let chapterTitleWithPart = '';
        
        if (detectedLanguage === 'vietnamese') {
          const prefix = detectedStructure === 'markdown' ? '## ' : '';
          const type = chapterTitle.match(/^(Ch∆∞∆°ng|Ph·∫ßn|B√†i)/) ? '' : 'Ch∆∞∆°ng ';
          
          if (numParts > 1) {
            chapterTitleWithPart = `${prefix}${type}${currentChapter}: ${chapterTitle} (${partNumber})`;
          } else {
            chapterTitleWithPart = `${prefix}${type}${currentChapter}: ${chapterTitle}`;
          }
        } 
        else if (detectedLanguage === 'chinese') {
          if (isEndOfLine) {
            chapterTitleWithPart = numParts > 1 
              ? `Á¨¨${currentChapter}Á´† (${partNumber})`
              : `Á¨¨${currentChapter}Á´†`;
          } else {
            chapterTitleWithPart = numParts > 1 
              ? `Á¨¨${currentChapter}Á´† ${chapterTitle} (${partNumber})`
              : `Á¨¨${currentChapter}Á´† ${chapterTitle}`;
          }
        }
        else if (detectedLanguage === 'english') {
          if (detectedStructure === 'number-only') {
            chapterTitleWithPart = numParts > 1
              ? `${currentChapter}. ${chapterTitle} (Part ${partNumber})`
              : `${currentChapter}. ${chapterTitle}`;
          } else {
            const type = chapterTitleMatch ? chapterTitleMatch[1] : 'Chapter';
            chapterTitleWithPart = numParts > 1
              ? `${type} ${currentChapter}: ${chapterTitle} (Part ${partNumber})`
              : `${type} ${currentChapter}: ${chapterTitle}`;
          }
        }
        
        // Th√™m ti√™u ƒë·ªÅ v√†o k·∫øt qu·∫£
        result += chapterTitleWithPart;
        
        // Th√™m newline n·∫øu l√† tr∆∞·ªùng h·ª£p ti√™u ƒë·ªÅ ·ªü cu·ªëi d√≤ng
        if (isEndOfLine) {
          result += '\n';
        } else {
          result += '\n';
        }
        
        // Th√™m n·ªôi dung ph·∫ßn
        result += part.text;
        
        // Th√™m ng·∫Øt trang ho·∫∑c xu·ªëng d√≤ng
        result += pageBreak;
      });

      return {
        text: result,
        nextChapterNumber: chapterNumber + numParts
      };
    }

    // Sao ch√©p k·∫øt qu·∫£
    function copyText() {
      const outputText = document.getElementById('outputText');
      outputText.select();
      document.execCommand('copy');
      
      // Hi·ªÉn th·ªã th√¥ng b√°o
      const originalText = outputText.value;
      outputText.value = "‚úì ƒê√£ sao ch√©p v√†o clipboard!\n\n" + originalText;
      setTimeout(() => {
        outputText.value = originalText;
      }, 2000);
    }

    // T·∫£i xu·ªëng file
    function downloadText() {
      const text = document.getElementById('outputText').value;
      if (!text) {
        alert('Ch∆∞a c√≥ n·ªôi dung ƒë·ªÉ t·∫£i xu·ªëng!');
        return;
      }

      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = generateFileName();
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // T·∫°o t√™n file t·ª± ƒë·ªông
    function generateFileName() {
      const now = new Date();
      const dateStr = now.toISOString().slice(0, 10);
      const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, '-');
      
      let langPrefix = '';
      if (detectedLanguage === 'vietnamese') langPrefix = 'VN_';
      else if (detectedLanguage === 'chinese') langPrefix = 'CN_';
      else if (detectedLanguage === 'english') langPrefix = 'EN_';
      
      return `${langPrefix}split_text_${dateStr}_${timeStr}.txt`;
    }

    // T·ª± ƒë·ªông nh·∫≠n di·ªán khi ng∆∞·ªùi d√πng nh·∫≠p li·ªáu
    document.getElementById('inputText').addEventListener('input', function() {
      detectTextInfo();
    });

    // Kh·ªüi t·∫°o
    document.addEventListener('DOMContentLoaded', function() {
      // ·∫®n c√°c ph·∫ßn t·ª≠ kh√¥ng c·∫ßn thi·∫øt l√∫c ƒë·∫ßu
      document.getElementById('advancedOptions').style.display = 'none';
    });
  </script>
</body>
</html>